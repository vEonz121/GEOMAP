<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=
    , initial-scale=1.0"
    />
    <title>Data Visualization Mini Project</title>
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
  </head>

  <script type="text/javascript">
    function plot(graph, chart) {
      var figure = JSON.parse(graph);
      Plotly.newPlot(chart, figure, {});
    }
  </script>

  <body>
    <center>
      <!-----------------------------Name & ID-------------------------------->
      <h1>Data Visualization - Lab 5</h1>
      <h2><pre>Name: Abdallah Jehad Sami Kishawi    ID: 17007230</pre></h2>

      <!-----------------------------Graph 1-------------------------------->
      <div>
        <div
          class="col-sm-6 p-2 shadow ml-4 mr-4 mb-4 bg-white rounded"
          style="width: 700px"
        >
          <div id="graph1"></div>
          <div>
            <p
              align="right"
              style="font-family: arial; font-size: 12px; font-style: italic"
            >
              [referance]
            </p>
          </div>
          <div>
            <br />
            <p align="justify">[empty]</p>
          </div>
        </div>
      </div>

      <!-----------------------------Graph 2-------------------------------->
      <div>
        <div
          class="col-sm-6 p-2 shadow ml-4 mr-4 mb-4 bg-white rounded"
          style="width: 700px"
        >
          <div id="graph2"></div>
          <div>
            <p
              align="right"
              style="font-family: arial; font-size: 12px; font-style: italic"
            >
              [referance]
            </p>
          </div>
          <div>
            <br />
            <p align="justify">[empty]</p>
          </div>
        </div>
      </div>

      <script type="text/javascript">
        const getRowOfCountry = (allData, countryName, returnArray = true) => {
          debugger;
          asObject = allData.find((row) => row.location === countryName);
          if (!returnArray) return asObject;
          const order = [
            "qol-2020-normalised",
            "health-care-2020-normalised",
            "col-2020-normalised",
            "crime-2020-normalised",
            "safety-2020-normalised",
            "gdp-2019-normalised",
            "life-expectancy-2019-normalised",
          ];
          return order.map((key) => {
            return asObject[key];
          });
        };
        window.selectedcountry = "";
        d3.csv("clean_data.csv", function (err, rows) {
          function unpack(rows, key) {
            return rows.map(function (row) {
              return row[key];
            });
          }

          var dataMap = [
            {
              type: "choropleth",
              locationmode: "country names",
              locations: unpack(rows, "location"),
              z: unpack(rows, "qol-2020-normalised"),
              text: unpack(rows, "location"),
              autocolorscale: true,
            },
          ];

          //    geo = dict(showlakes = True, lakecolor = 'rgb(0,191,255)', showocean=True ,oceancolor= "rgb(0,191,255)", projection_type="orthographic", scope = "world"))

          var layoutMap = {
            title: "QoL Accross Asian Countries",
            geo: {
              scope: "world",
              showlakes: true,
              lakecolor: "rgb(0, 191, 255)",
              showocean: true,
              oceancolor: "rgb(0, 191, 255)",
              projection: {
                type: "orthographic",
              },
            },
          };

          Plotly.newPlot("graph1", dataMap, layoutMap, {
            showLink: false,
          }).then((gd) => {
            gd.on("plotly_click", (d) => {
              var pt = (d.points || [])[0];
              window.selectedcountry = pt.location;

              dataRadar = [
                {
                  type: "scatterpolar",
                  r: [5.3, 5.5, 5.0, 5.2, 5.8, 5.6, 5.6],
                  theta: rows.columns.slice(2),
                  fill: "toself",
                  name: "Average",
                },
                {
                  type: "scatterpolar",
                  r: getRowOfCountry(rows, window.selectedcountry),
                  theta: rows.columns.slice(2),
                  fill: "toself",
                  name: window.selectedcountry,
                },
              ];

              layoutRadar = {
                polar: {
                  radialaxis: {
                    visible: true,
                    range: [0, 10],
                  },
                },
                showlegend: false,
              };

              Plotly.newPlot("graph2", dataRadar, layoutRadar);
              // console.log(pt.location);
              // console.log(pt.z);
              // console.log(pt);
            });
          });
          console.log(rows);
        });
      </script>
    </center>
  </body>
</html>
